<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Swimming settings</title>
</head>
<style>
    .top div, .top button {
        margin: 10px;
        font: 14px Verdana;
    }
</style>
<link href="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/9.9.2/jsoneditor.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsoneditor/9.9.2/jsoneditor.min.js"></script>

<style>
    body, html {
        margin: 0;
        height: 100%;
    }

    .root {
        display: grid;
        grid-template-rows: minmax(40px, auto) minmax(0, 100%);
        height: 100%;
    }

    .top {
        margin: 10px;
    }
</style>

<body>
<div class="root">
    <div class="top">
        <fieldset>
            <legend>Search mode:</legend>
            <div>
                <input type="radio" id="online" name="mode" value="online" onchange="searchMode(this)">
                <label for="online">Online</label>
            </div>
            <div>
                <input type="radio" id="cache" name="mode" value="cache" onchange="searchMode(this)">
                <label for="cache">Cache</label>
            </div>
            <div>
                <input type="radio" id="offline" name="mode" value="offline" onchange="searchMode(this)">
                <label for="offline">Offline</label>
            </div>
        </fieldset>
        <div>
            Find Swimmer:
            <input id="sinput" style="width: 120px"/>
            <button onclick="load()" class="big">load</button>
            <button onclick="save()" class="big">save</button>
        </div>
    </div>

    <div id="jsoneditor"></div>
</div>
</body>

<script>

    const modeElems = document.getElementsByName('mode');
    async function searchMode(elem) {
        if (!elem || elem.checked) {
            let response = await fetch('mode' + (elem && elem.checked ? '?mode=' + elem.value : ''));
            if (response.ok) {
                let data = await response.json()
                console.log(data)
                document.getElementById(data.mode).checked = true
            }
        }
    }

    searchMode()

    editor = new JSONEditor(document.getElementById('jsoneditor'), {
        mode: 'tree',
        modes: ['code', 'tree'],
    })

    const sinputElem = document.getElementById('sinput');

    sinputElem.addEventListener('keypress', (event) => {
        if (event.key == 'Enter') {
            load();
        }
    });

    async function load() {
        let response = await fetch('swimmer?id=' + sinputElem.value)
        if (response.ok) {
            editor.set(await response.json())
        } else {
            alert(await response.text())
        }
    }

    async function save() {
        let response = await fetch('swimmer?id=' + sinputElem.value, {
            method: "PUT",
            headers: {
                "Content-Type": "text/json"
            },
            body: JSON.stringify(editor.get())
        });
        if (response.ok) {
            alert("DONE")
        } else {
            alert(await response.text())
        }
    }

</script>
</html>